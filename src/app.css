@import 'tailwindcss';
@import './styles/tokens.css';

/* Tailwind v4: use .dark class on html for theme toggle (not just prefers-color-scheme) */
@custom-variant dark (&:where(.dark, .dark *));

@theme {
  --font-sans: 'Inter', system-ui, ui-sans-serif, sans-serif;
  /* Single source of truth: Tailwind spacing uses one multiplier base */
  --spacing: var(--space-1);
  /* Global radius kill switch: utilities still work; themes set --ui-radius */
  --radius-sm: var(--ui-radius);
  --radius-md: var(--ui-radius);
  --radius-lg: var(--ui-radius);
  --radius-xl: var(--ui-radius);
  --radius-2xl: var(--ui-radius);
}

/* Default radius (Cathedral overrides to --radius-none) */
:root {
  --ui-radius: var(--radius-md);
  /* Temporal theme evolution (controller overwrites when data-ui-theme="temporal") */
  --ui-bg-intensity: 1;
  --ui-saturation: 1;
  --ui-depth-multiplier: 1;
  --ui-blur-strength: 1;
  --ui-shadow-depth: 1;
  --ui-panel-separation: 1;
  --ui-texture-opacity: 0;
}

/* Base: refined neutral backgrounds, darker dark mode */
html {
  @apply antialiased;
}

/* Focus rings for keyboard (visible only on focus-visible) */
button:focus-visible,
a:focus-visible,
input:focus-visible,
textarea:focus-visible,
select:focus-visible,
[role="button"]:focus-visible,
[role="combobox"]:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px var(--ui-bg-main), 0 0 0 4px var(--ui-accent);
  border-radius: var(--ui-radius);
}

body {
  @apply min-h-screen text-zinc-800 dark:text-zinc-200;
  background-color: #fafafa;
}

html,
body {
  overflow-x: hidden;
  max-width: 100vw;
}

/* Stop state for send button (themes override; neural uses .chat-input-container .chat-send-button) */
.chat-send-button[data-state="stop"] {
  background: var(--ui-accent-hot, #dc2626);
}

/* Fallback error UI (main.js): token spacing only */
.error-pre {
  padding: var(--space-4);
  color: red;
  white-space: pre-wrap;
  font-family: var(--font-mono);
}

.dark body {
  background-color: #0d0d0d;
}

/* Metrics graph axes/grid (light gray in light mode, subtle light in dark) */
html {
  --metrics-axis: #d4d4d4;
  --metrics-grid: #e5e5e5;
}

.dark {
  --metrics-axis: rgba(255, 255, 255, 0.18);
  --metrics-grid: rgba(255, 255, 255, 0.08);
}

/* Monospace for metrics */
.font-mono {
  font-feature-settings: "tnum";
}

/* Markdown content in message bubbles */
.prose-chat h1 {
  @apply text-lg font-bold mt-3 mb-1 leading-snug;
}

.prose-chat h2 {
  @apply text-base font-semibold mt-2 mb-1 leading-snug;
}

.prose-chat h3 {
  @apply text-sm font-semibold mt-1 mb-1 leading-snug;
}

.prose-chat p {
  @apply my-1.5 leading-snug;
}

.prose-chat ul {
  @apply list-disc pl-5 my-1.5 leading-snug;
}

.prose-chat ol {
  @apply list-decimal pl-5 my-1.5 leading-snug;
}

.prose-chat {
  font-size: 13.5px;
  line-height: 1.5;
}

.prose-chat pre {
  border-radius: 8px;
  @apply p-2.5 my-1.5 overflow-x-auto text-[13px] leading-snug;
}

.prose-chat code {
  border-radius: 6px;
  @apply px-1 py-0.5 text-xs;
}

.prose-chat pre code {
  @apply p-0 bg-transparent text-[13px];
}

.prose-chat blockquote {
  @apply border-l-4 border-zinc-300 dark:border-zinc-600 pl-3 my-1.5 italic;
}

.prose-chat a {
  @apply text-blue-600 dark:text-blue-400 underline;
}

/* Code block wrapper: header + actions (copy, run, save) */
.code-block-wrapper {
  position: relative;
  margin: 0.5rem 0;
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid var(--ui-border);
}

.code-block-header {
  position: sticky;
  top: 0;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.35rem 0.75rem;
  background: color-mix(in srgb, var(--ui-bg-sidebar) 95%, transparent);
  backdrop-filter: blur(8px);
  border-bottom: 1px solid var(--ui-border);
  font-size: 0.75rem;
}

.code-block-lang {
  color: var(--ui-text-primary);
  font-family: var(--font-mono);
  font-weight: 500;
  text-transform: lowercase;
}

.code-block-actions {
  display: flex;
  gap: 0.5rem;
}

.code-action-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  background: transparent;
  color: var(--ui-text-secondary);
  border: 1px solid transparent;
  cursor: pointer;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 500;
  line-height: 1;
  transition: all 0.2s;
}

.code-action-btn:hover {
  color: var(--ui-text-primary);
  background: color-mix(in srgb, var(--ui-text-primary) 8%, transparent);
}

.code-action-apply {
  background: color-mix(in srgb, var(--ui-accent) 15%, transparent);
  color: var(--ui-accent);
  border-color: color-mix(in srgb, var(--ui-accent) 30%, transparent);
}

.code-action-apply:hover {
  background: color-mix(in srgb, var(--ui-accent) 25%, transparent);
  color: var(--ui-accent);
}

/* Code block content: dark background (theme sets --ui-code-bg; default 1e1e2e) */
.code-block-wrapper pre {
  background: var(--ui-code-bg, #1e1e2e) !important;
  color: #abb2bf !important;
  border-radius: 0 0 12px 12px;
}

.code-block-wrapper pre code {
  background: transparent !important;
  color: inherit !important;
}

/* Strong, readable highlight.js token colors on dark background (One Dark–style) */
.code-block-wrapper .hljs,
.code-block-wrapper .hljs-subst {
  color: #abb2bf;
}

.code-block-wrapper .hljs-string,
.code-block-wrapper .hljs-addition {
  color: #98c379;
}

.code-block-wrapper .hljs-keyword,
.code-block-wrapper .hljs-selector-tag,
.code-block-wrapper .hljs-name {
  color: #c678dd;
}

.code-block-wrapper .hljs-number {
  color: #d19a66;
}

.code-block-wrapper .hljs-attr,
.code-block-wrapper .hljs-attribute,
.code-block-wrapper .hljs-variable {
  color: #56b6c2;
}

.code-block-wrapper .hljs-title,
.code-block-wrapper .hljs-title.function_ {
  color: #61afef;
}

.code-block-wrapper .hljs-comment,
.code-block-wrapper .hljs-quote {
  color: #5c6370;
  font-style: italic;
}

.code-block-wrapper .hljs-built_in,
.code-block-wrapper .hljs-class .hljs-title {
  color: #e6c07b;
}

.code-block-wrapper .hljs-params {
  color: #abb2bf;
}

.code-block-wrapper .hljs-regexp,
.code-block-wrapper .hljs-meta {
  color: #56b6c2;
}

.code-block-wrapper .hljs-doctag,
.code-block-wrapper .hljs-section {
  color: #61afef;
}

.code-block-wrapper .hljs-deletion {
  color: #e06c75;
}

.code-block-wrapper .hljs-symbol,
.code-block-wrapper .hljs-bullet,
.code-block-wrapper .hljs-link {
  color: #56b6c2;
}

.code-block-wrapper .hljs-literal {
  color: #56b6c2;
}

.code-block-wrapper .hljs-type {
  color: #e6c07b;
}

.code-block-wrapper .hljs-selector-id,
.code-block-wrapper .hljs-selector-class {
  color: #e6c07b;
}

.code-block-wrapper .hljs-selector-attr,
.code-block-wrapper .hljs-selector-pseudo {
  color: #e6c07b;
}

.code-block-wrapper .hljs-template-tag,
.code-block-wrapper .hljs-template-variable {
  color: #e06c75;
}

.code-block-wrapper .hljs-emphasis {
  font-style: italic;
}

.code-block-wrapper .hljs-strong {
  font-weight: bold;
}

/* Assistant: thinking (light italics) vs answer (standard) when model uses think tags */
.assistant-thinking {
  font-style: italic;
  opacity: 0.85;
  color: var(--ui-text-secondary);
}

.assistant-answer {
  font-style: normal;
}

/* Accent: American flag red with contrasting bright orbit colors */
:root {
  --atom-accent: #B22234;
  --atom-accent-light: #E03c51;
  --atom-teal: #06b6d4;
  --atom-amber: #f59e0b;
}

.dark {
  --atom-accent: #DC143C;
  --atom-accent-light: #E03c51;
  --atom-teal: #22d3ee;
  --atom-amber: #fbbf24;
}

/* Thinking indicator: sleek minimal atom – theme accent, GPU-friendly animation */
@keyframes atom-nucleus-pulse {

  0%,
  100% {
    opacity: 0.6;
  }

  50% {
    opacity: 1;
  }
}

@keyframes atom-orbit-spin {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(360deg);
  }
}

@keyframes atom-orbit-spin-reverse {
  from {
    transform: rotate(360deg);
  }

  to {
    transform: rotate(0deg);
  }
}

.thinking-atom-icon {
  display: block;
  /* Nucleus glow uses theme accent so it contrasts with any background */
  --atom-nucleus-glow: color-mix(in srgb, var(--ui-accent) 70%, transparent);
  filter: drop-shadow(0 0 6px var(--atom-nucleus-glow)) drop-shadow(0 0 10px var(--atom-nucleus-glow));
}

.thinking-atom-nucleus {
  fill: var(--ui-accent);
  transform-origin: 16px 16px;
  animation: atom-nucleus-pulse var(--duration-long) var(--ease-in-out) infinite;
  filter: drop-shadow(0 0 4px var(--ui-accent));
}

.thinking-atom-orbit,
.thinking-atom-orbit-2,
.thinking-atom-orbit-3 {
  transform-origin: 16px 16px;
  stroke-width: 1.5;
  stroke-linecap: round;
  fill: none;
  opacity: 1;
}

.thinking-atom-orbit {
  stroke: #00f0ff;
  animation: atom-orbit-spin 4s linear infinite;
}

.thinking-atom-orbit-2 {
  stroke: #ff00ff;
  animation: atom-orbit-spin-reverse 3s linear infinite;
}

.thinking-atom-orbit-3 {
  stroke: #00ff00;
  animation: atom-orbit-spin 5s linear infinite;
}

@media (prefers-reduced-motion: reduce) {

  .thinking-atom-icon .thinking-atom-nucleus,
  .thinking-atom-icon .thinking-atom-orbit,
  .thinking-atom-icon .thinking-atom-orbit-2,
  .thinking-atom-icon .thinking-atom-orbit-3 {
    animation: none;
  }

  .thinking-atom-icon .thinking-atom-nucleus {
    opacity: 1;
  }
}

/* ATOM logo (static, theme-aware – used next to wordmark in header and splash) */
.atom-logo-icon {
  display: block;
}

.atom-logo-nucleus {
  fill: var(--atom-accent);
}

.atom-logo-orbit-1 {
  stroke: var(--atom-accent-light);
}

.atom-logo-orbit-2 {
  stroke: var(--atom-teal);
}

.atom-logo-orbit-3 {
  stroke: var(--atom-amber);
}

/* Header atom: animate when preparing message (e.g. fetching GitHub) or streaming */
.atom-logo-icon-active .atom-logo-orbit-1 {
  transform-origin: 16px 16px;
  animation: atom-orbit-spin 4s linear infinite;
}

.atom-logo-icon-active .atom-logo-orbit-2 {
  transform-origin: 16px 16px;
  animation: atom-orbit-spin-reverse 3s linear infinite;
}

.atom-logo-icon-active .atom-logo-orbit-3 {
  transform-origin: 16px 16px;
  animation: atom-orbit-spin 5s linear infinite;
}

.atom-logo-icon-active .atom-logo-nucleus {
  transform-origin: 16px 16px;
  animation: atom-nucleus-pulse var(--duration-long) var(--ease-in-out) infinite;
}

@media (prefers-reduced-motion: reduce) {

  .atom-logo-icon-active .atom-logo-orbit-1,
  .atom-logo-icon-active .atom-logo-orbit-2,
  .atom-logo-icon-active .atom-logo-orbit-3,
  .atom-logo-icon-active .atom-logo-nucleus {
    animation: none;
  }
}

/* Max tokens: hide native spinner so only double/half buttons are used */
.max-tokens-step-input::-webkit-inner-spin-button,
.max-tokens-step-input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.max-tokens-step-input {
  -moz-appearance: textfield;
  appearance: textfield;
}

.batch-size-step-input::-webkit-inner-spin-button,
.batch-size-step-input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.batch-size-step-input {
  -moz-appearance: textfield;
  appearance: textfield;
}

/* Panel tabs: open/close side panels — larger, higher contrast, optional label */
.panel-tab {
  position: absolute;
  width: 32px;
  min-width: 32px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--ui-border);
  background: color-mix(in srgb, var(--ui-accent) 8%, var(--ui-bg-sidebar));
  color: var(--ui-accent);
  cursor: pointer;
  transition: background-color var(--duration-normal), color var(--duration-normal), box-shadow var(--duration-normal);
  z-index: 10;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
}

.panel-tab:hover {
  background: color-mix(in srgb, var(--ui-accent) 18%, var(--ui-bg-sidebar));
  color: var(--ui-text-primary);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
}

.panel-tab:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px var(--ui-bg-main), 0 0 0 4px var(--ui-accent);
}

.panel-tab svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}

.panel-tab-strip-label {
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.02em;
  writing-mode: vertical-rl;
  text-orientation: mixed;
  transform: rotate(180deg);
  color: var(--ui-accent);
  opacity: 0.95;
  line-height: 1.2;
}

.panel-tab-strip-icon {
  width: 20px;
  height: 20px;
  color: var(--ui-accent);
  flex-shrink: 0;
}

/* Same height on both strips: icon sits just a small gap above the arrow tab (tab is 64px tall, centered at 50%) */
.panel-tab-strip-icon-wrap {
  position: absolute;
  left: 0;
  right: 0;
  top: calc(50% - 62px);
  height: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
}

@keyframes panel-tab-bounce {
  0% {
    transform: var(--panel-tab-transform) scale(1);
  }

  40% {
    transform: var(--panel-tab-transform) scale(1.15);
  }

  70% {
    transform: var(--panel-tab-transform) scale(0.97);
  }

  100% {
    transform: var(--panel-tab-transform) scale(1);
  }
}

.panel-tab-bounce {
  animation: panel-tab-bounce var(--duration-slow) var(--ease-out);
}

/* Micro-animations (subtle system feedback) */
@keyframes ui-input-breathe {

  0%,
  100% {
    transform: scale(1);
    box-shadow: 0 0 0 rgba(0, 0, 0, 0);
  }

  50% {
    transform: scale(1.008);
    box-shadow: 0 0 18px rgba(220, 38, 38, 0.08);
  }
}

.ui-input-breathe {
  animation: ui-input-breathe var(--duration-long) var(--ease-in-out) infinite;
}

@keyframes ui-odometer-scan {
  0% {
    background-position-y: 0;
  }

  100% {
    background-position-y: 6px;
  }
}

.ui-odometer {
  position: relative;
  display: inline-block;
  font-variant-numeric: tabular-nums;
  letter-spacing: 0.02em;
}

.ui-odometer-active::after {
  content: '';
  position: absolute;
  inset: -2px -3px;
  background: repeating-linear-gradient(0deg,
      rgba(220, 38, 38, 0.25) 0,
      rgba(220, 38, 38, 0.25) 1px,
      transparent 1px,
      transparent 3px);
  opacity: 0.35;
  mix-blend-mode: multiply;
  pointer-events: none;
  animation: ui-odometer-scan var(--duration-slower) linear infinite;
}

@keyframes ui-gpu-pulse {
  0% {
    transform: translateX(-120%);
    opacity: 0.25;
  }

  50% {
    opacity: 0.85;
  }

  100% {
    transform: translateX(220%);
    opacity: 0.25;
  }
}

/* Sparkline for tokens/sec */
.ui-sparkline {
  display: block;
}

.ui-sparkline-line {
  stroke: rgba(148, 163, 184, 0.6);
  stroke-width: 1.2;
}

.ui-sparkline-active {
  stroke: rgba(220, 38, 38, 0.9);
}

/* Command palette (Ctrl+K): backdrop blur + scale-in */
@keyframes command-palette-in {
  from {
    opacity: 0;
    transform: scale(0.96);
  }

  to {
    opacity: 1;
    transform: scale(1);
  }
}

.command-palette-backdrop {
  background: rgba(0, 0, 0, 0.4);
  -webkit-backdrop-filter: blur(8px);
  backdrop-filter: blur(8px);
}

.command-palette-modal {
  animation: command-palette-in var(--duration-normal) var(--ease-out);
}

/* Message entrance: subtle fade + slide */
@keyframes message-entrance {
  from {
    opacity: 0;
    transform: translateY(6px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Chat message list: consistent body text size with input and bubbles; contain layout to reduce thrashing during stream */
.chat-message-list {
  font-size: 14px;
  contain: layout;
}

/* Chat scroll area: thin, subtle scrollbar and smooth scroll; anchor for stable streaming */
.chat-scroll-area {
  overflow-anchor: auto;
  scrollbar-width: thin;
  scrollbar-color: rgba(0, 0, 0, 0.15) transparent;
}

.chat-scroll-area::-webkit-scrollbar {
  width: 8px;
}

.chat-scroll-area::-webkit-scrollbar-track {
  background: transparent;
}

.chat-scroll-area::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.15);
  border-radius: 4px;
}

.chat-scroll-area::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 0, 0, 0.22);
}

/* Message entrance: handled by Svelte in:fly on MessageBubble (see MessageBubble.svelte).
   Class kept for any layout; animation removed so Svelte transition is visible. */
.message-entrance {
  /* was: animation: message-entrance 0.25s ease-out; */
}

/* Cockpit Intel panel: slide in from right */
@keyframes intel-panel-in {
  from {
    opacity: 0;
    transform: translateX(12px);
  }

  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.intel-panel-enter {
  animation: intel-panel-in var(--duration-normal) var(--ease-out);
}

/* Convo rail width transition is inline (transition-[width] duration-200) */

/* User bubble: theme-tinted, translucent */
.ui-user-bubble {
  background-color: var(--ui-accent);
  background-color: color-mix(in srgb, var(--ui-accent) 20%, transparent);
  color: var(--ui-text-primary);
  border: 1px solid var(--ui-accent);
  border-color: color-mix(in srgb, var(--ui-accent) 35%, transparent);
  -webkit-backdrop-filter: blur(6px);
  backdrop-filter: blur(6px);
}

@media (prefers-reduced-motion: reduce) {

  .ui-input-breathe,
  .ui-odometer-active::after,
  .ui-gpu-meter-active::after {
    animation: none !important;
  }
}

/* ========== UI theme variables (data-ui-theme on root) — 3 themes only ========== */
/* THEME 1: light (default) */
[data-ui-theme="light"] {
  --ui-bg-main: #ffffff;
  --ui-bg-sidebar: #f5f5f5;
  --ui-accent: #2563eb;
  --ui-accent-hot: #dc2626;
  --ui-text-primary: #1a1a1a;
  --ui-text-secondary: #666666;
  --ui-border: #e5e5e5;
  --ui-sidebar-active: #eeeeee;
  --ui-sidebar-hover: #f5f5f5;
  --ui-input-bg: #ffffff;
  --ui-input-border: #e5e5e5;
  --ui-glow: rgba(37, 99, 235, 0.2);
  --ui-code-bg: #1e1e2e;
  --atom-accent: #2563eb;
  --atom-accent-light: #3b82f6;
  --atom-teal: #0ea5e9;
  --atom-amber: #f59e0b;
}

[data-ui-theme="light"] body {
  background-color: #ffffff;
}

/* THEME 2: dark */
[data-ui-theme="dark"] {
  --ui-bg-main: #111111;
  --ui-bg-sidebar: #111111;
  --ui-accent: #3b82f6;
  --ui-accent-hot: #f87171;
  --ui-text-primary: #e5e5e5;
  --ui-text-secondary: #999999;
  --ui-border: #333333;
  --ui-sidebar-active: #2d2d2d;
  --ui-sidebar-hover: #333333;
  --ui-input-bg: #111111;
  --ui-input-border: #404040;
  --ui-glow: rgba(59, 130, 246, 0.25);
  --ui-code-bg: #111111;
  --atom-accent: #3b82f6;
  --atom-accent-light: #60a5fa;
  --atom-teal: #22d3ee;
  --atom-amber: #fbbf24;
}

[data-ui-theme="dark"] body {
  background-color: #111111;
}

/* THEME 3: coder (GitHub dark / terminal) */
[data-ui-theme="coder"] {
  --ui-bg-main: #000000;
  --ui-bg-sidebar: #000000;
  --ui-accent: #39d353;
  --ui-accent-hot: #f85149;
  --ui-text-primary: #c9d1d9;
  --ui-text-secondary: #8b949e;
  --ui-border: #30363d;
  --ui-sidebar-active: #161b22;
  --ui-sidebar-hover: #30363d;
  --ui-input-bg: #000000;
  --ui-input-border: #30363d;
  --ui-glow: rgba(57, 211, 83, 0.2);
  --ui-code-bg: #000000;
  --atom-accent: #39d353;
  --atom-accent-light: #56d364;
  --atom-teal: #39d353;
  --atom-amber: #d29922;
}

[data-ui-theme="coder"] body {
  background-color: #000000;
}

[data-ui-theme="coder"] .code-block-wrapper pre {
  background: #000000 !important;
}

/* THEME 4: ollama – Light mode (default) */
[data-ui-theme="ollama"] {
  --ui-bg-main: #fcfcfc;
  --ui-bg-sidebar: #f7f7f7;
  --ui-accent: #101010;
  --ui-accent-hot: #ef4444;
  --ui-text-primary: #171717;
  --ui-text-secondary: #6B7280;
  --ui-border: #e5e7eb;
  --ui-sidebar-active: #ececec;
  --ui-sidebar-hover: #f3f4f6;
  --ui-input-bg: #ffffff;
  --ui-input-border: #d1d5db;
  --ui-glow: rgba(0, 0, 0, 0.05);
  --ui-code-bg: #111827;
  --atom-accent: #111827;
  --atom-accent-light: #374151;
  --atom-teal: #10b981;
  --atom-amber: #f59e0b;
}

/* THEME 4: ollama – Dark mode */
.dark[data-ui-theme="ollama"],
[data-ui-theme="ollama"].dark {
  --ui-bg-main: #1a1a1a;
  --ui-bg-sidebar: #141414;
  --ui-accent: #e0e0e0;
  --ui-accent-hot: #ef4444;
  --ui-text-primary: #e8e8e8;
  --ui-text-secondary: #9ca3af;
  --ui-border: #2a2a2a;
  --ui-sidebar-active: #252525;
  --ui-sidebar-hover: #2a2a2a;
  --ui-input-bg: #1e1e1e;
  --ui-input-border: #3a3a3a;
  --ui-glow: rgba(255, 255, 255, 0.05);
  --ui-code-bg: #111111;
  --atom-accent: #e0e0e0;
  --atom-accent-light: #b0b0b0;
  --atom-teal: #10b981;
  --atom-amber: #f59e0b;
}

[data-ui-theme="ollama"].dark body {
  background-color: #1a1a1a;
}

/* THEME 5: perplexity – Light mode (Emerald Green) */
[data-ui-theme="perplexity"] {
  --ui-accent: #0ca678;
  /* Darker emerald for light bg */
  --ui-accent-hot: #e03131;
  --ui-bg-main: #f5faf7;
  --ui-bg-sidebar: #eaf5ee;
  --ui-text-primary: #1a2e1a;
  --ui-text-secondary: #4a6a4a;
  --ui-border: #c8dcc8;
  --ui-sidebar-active: #d4ecd4;
  --ui-sidebar-hover: #e0f0e0;
  --ui-input-bg: #ffffff;
  --ui-input-border: #b8d4b8;
  --ui-glow: rgba(12, 166, 120, 0.15);
  --ui-code-bg: #eef6f0;
  --atom-accent: #0ca678;
  --atom-accent-light: #20c997;
  --atom-teal: #0ca678;
  --atom-amber: #e8a800;
}

/* THEME 5: perplexity – Dark mode (Emerald Green) */
.dark[data-ui-theme="perplexity"],
[data-ui-theme="perplexity"].dark {
  --ui-bg-main: #0a0c0a;
  --ui-bg-sidebar: #050705;
  --ui-accent: #20c997;
  --ui-accent-hot: #ff6b6b;
  --ui-text-primary: #e8f0e8;
  --ui-text-secondary: #8a9a8a;
  --ui-border: #162016;
  --ui-sidebar-active: #0f160f;
  --ui-sidebar-hover: #162016;
  --ui-input-bg: #0b0f0b;
  --ui-input-border: #1e2e1e;
  --ui-glow: rgba(32, 201, 151, 0.2);
  --ui-code-bg: #0a0c0a;
  --atom-accent: #20c997;
  --atom-accent-light: #38d9a9;
  --atom-teal: #20c997;
  --atom-amber: #ffd43b;
}

[data-ui-theme="perplexity"].dark body {
  background-color: #0a0c0a;
}


/* Theme-aware utilities (glow, etc.) */
.ui-input-glow:focus-within {
  border-color: var(--ui-accent-cool, var(--ui-accent));
  box-shadow: 0 0 15px var(--ui-glow);
}

.ui-input-glow textarea::placeholder {
  color: var(--ui-text-secondary);
  opacity: 0.9;
}

.ui-btn-accent {
  background: var(--ui-accent);
  color: var(--ui-bg-main);
  box-shadow: 0 4px 15px var(--ui-glow);
  transition: all var(--duration-fast) var(--ease-default);
}

.ui-btn-accent:hover {
  box-shadow: 0 6px 20px var(--ui-glow);
  transform: translateY(-1px);
}

.ui-sidebar-active {
  border-left: 3px solid var(--ui-accent-cool, var(--ui-accent));
  background: linear-gradient(90deg, var(--ui-glow) 0%, transparent 100%);
}

.ui-pill-suggestion {
  color: var(--ui-accent);
  border-color: var(--ui-accent);
  background: transparent;
  transition: all var(--duration-fast) var(--ease-default);
}

.ui-pill-suggestion:hover {
  background: var(--ui-accent);
  color: var(--ui-bg-main);
}

.ui-model-selector-open {
  border-color: var(--ui-accent-cool, var(--ui-accent)) !important;
}

/* ========== Dynamic UI (theme/layout transitions, animations) ========== */
/* Revert: see docs/ATOM-DYNAMIC-UI-UNDO.md */

/* Theme switch and layout: token durations only */
html {
  transition: background-color var(--duration-slower) var(--ease-default), color var(--duration-slower) var(--ease-default);
}

body {
  transition: background-color var(--duration-slower) var(--ease-default);
}

.atom-layout-transition,
.atom-panel-wrap {
  transition: width var(--duration-slow) var(--ease-default), min-width var(--duration-slow) var(--ease-default), grid-template-columns var(--duration-slow) var(--ease-default), opacity var(--duration-slow) var(--ease-default);
}

.model-card-active {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Model selector and controls: clear sans-serif for readability */
.ui-model-selector,
.ui-model-selector * {
  font-family: var(--font-sans);
}

/* Streaming: pulsing border glow */
.atom-streaming-glow {
  animation: atom-streaming-glow var(--duration-long) var(--ease-in-out) infinite;
}

@keyframes atom-streaming-glow {

  0%,
  100% {
    box-shadow: 0 0 0 1px var(--ui-border), 0 0 12px rgba(6, 182, 212, 0.2);
  }

  50% {
    box-shadow: 0 0 0 1px var(--atom-teal), 0 0 20px rgba(6, 182, 212, 0.4);
  }
}

/* Response complete: brief green flash */
.atom-complete-flash {
  animation: atom-complete-flash var(--duration-slower) var(--ease-out) forwards;
}

@keyframes atom-complete-flash {
  0% {
    box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.5);
  }

  40% {
    box-shadow: 0 0 0 8px rgba(34, 197, 94, 0.15);
  }

  100% {
    box-shadow: 0 0 0 0 transparent;
  }
}

/* Error: red shake */
.atom-error-shake {
  animation: atom-error-shake var(--duration-slow) var(--ease-in-out);
}

@keyframes atom-error-shake {

  0%,
  100% {
    transform: translateX(0);
  }

  15% {
    transform: translateX(-6px);
  }

  30% {
    transform: translateX(5px);
  }

  45% {
    transform: translateX(-4px);
  }

  60% {
    transform: translateX(3px);
  }

  75% {
    transform: translateX(-2px);
  }
}

/* Subtle animated gradient background (15s loop, low opacity). Disabled in .atom-performance-mode */
.atom-gradient-bg::before {
  content: '';
  position: fixed;
  inset: 0;
  z-index: -1;
  opacity: 0.06;
  background: linear-gradient(135deg,
      var(--atom-teal) 0%,
      transparent 30%,
      var(--atom-accent) 50%,
      transparent 70%,
      var(--atom-amber) 100%);
  background-size: 200% 200%;
  animation: atom-gradient-drift 15s var(--ease-in-out) infinite;
  pointer-events: none;
}

.atom-performance-mode .atom-gradient-bg::before {
  display: none;
}

@keyframes atom-gradient-drift {

  0%,
  100% {
    background-position: 0% 50%;
  }

  50% {
    background-position: 100% 50%;
  }
}

/* ── Theme-aware accent for checkboxes and sliders ── */
.accent-themed {
  accent-color: var(--ui-accent);
}

/* Reduced motion: disable or shorten animations */
@media (prefers-reduced-motion: reduce) {

  html,
  body {
    transition-duration: 0.01ms;
  }

  .atom-layout-transition,
  .atom-panel-wrap {
    transition-duration: 0.01ms;
  }

  .atom-streaming-glow {
    animation: none;
    box-shadow: 0 0 0 1px var(--ui-border);
  }

  .atom-complete-flash {
    animation: none;
  }

  .atom-error-shake {
    animation: none;
  }

  .atom-gradient-bg::before {
    animation: none;
  }
}

/* Glassmorphism performance safeguard */
@media (prefers-reduced-motion: reduce) {
  * {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
}

.no-blur * {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* Glassmorphism utility & theme variables */
.glass {
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  background-color: var(--glass-bg);
  border: 1px solid var(--glass-border);
}

.glass-modal {
  background: var(--glass-bg-active) !important;
  border: 1px solid var(--glass-border-strong) !important;
  backdrop-filter: var(--glass-blur-strong) !important;
  -webkit-backdrop-filter: var(--glass-blur-strong) !important;
  box-shadow: var(--glass-shadow-strong) !important;
}

:root {
  --glass-bg: rgba(255, 255, 255, 0.6);
  --glass-bg-hover: rgba(255, 255, 255, 0.75);
  --glass-bg-active: rgba(255, 255, 255, 0.85);
  --glass-border: rgba(0, 0, 0, 0.08);
  --glass-border-strong: rgba(0, 0, 0, 0.14);
  --glass-blur: blur(12px);
  --glass-blur-strong: blur(20px);
  --glass-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
  --glass-shadow-strong: 0 8px 40px rgba(0, 0, 0, 0.2);
}

.dark,
[data-ui-theme="dark"],
[data-ui-theme="coder"],
[data-ui-theme="trek"] {
  --glass-bg: rgba(255, 255, 255, 0.04);
  --glass-bg-hover: rgba(255, 255, 255, 0.07);
  --glass-bg-active: rgba(255, 255, 255, 0.10);
  --glass-border: rgba(255, 255, 255, 0.08);
  --glass-border-strong: rgba(255, 255, 255, 0.14);
  --glass-blur: blur(12px);
  --glass-blur-strong: blur(20px);
  --glass-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
  --glass-shadow-strong: 0 8px 40px rgba(0, 0, 0, 0.5);
}